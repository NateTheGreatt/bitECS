"use strict";var dt=Object.defineProperty;var Vr=Object.getOwnPropertyDescriptor;var Xr=Object.getOwnPropertyNames;var Jr=Object.prototype.hasOwnProperty;var X=(e,t)=>{for(var r in t)dt(e,r,{get:t[r],enumerable:!0})},Zr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Xr(t))!Jr.call(e,o)&&o!==r&&dt(e,o,{get:()=>t[o],enumerable:!(n=Vr(t,o))||n.enumerable});return e};var Kr=e=>Zr(dt({},"__esModule",{value:!0}),e);var Wn={};X(Wn,{Changed:()=>ar,DESERIALIZE_MODE:()=>He,IsA:()=>Ge,Not:()=>ir,Pair:()=>ie,SYMBOLS:()=>An,Types:()=>le,Wildcard:()=>A,addComponent:()=>L,addComponents:()=>it,addEntity:()=>ue,addPrefab:()=>jr,archetypeHash:()=>Qe,commitRemovals:()=>It,createWorld:()=>Or,defineComponent:()=>st,defineDeserializer:()=>wr,defineEnterQueue:()=>Br,defineExitQueue:()=>Pr,definePrefab:()=>On,defineQuery:()=>Re,defineRelation:()=>_t,defineSerializer:()=>Lr,defineSystem:()=>Dr,defineWorld:()=>Nt,deleteWorld:()=>Ar,enableBufferedQueries:()=>Rr,enableManualEntityRecycling:()=>Qr,enterQuery:()=>fr,entityExists:()=>ct,exitQuery:()=>pr,flushRemovedEntities:()=>$r,getAllEntities:()=>Mr,getDefaultSize:()=>Er,getEntityComponents:()=>Ue,getRelationTargets:()=>Ie,getWorldComponents:()=>Wr,hasComponent:()=>k,parentArray:()=>nr,pipe:()=>Nr,query:()=>De,registerComponent:()=>_,registerComponents:()=>yr,registerPrefab:()=>ot,registerPrefabs:()=>Cn,registerQuery:()=>$e,registerWorld:()=>jt,removeComponent:()=>ae,removeComponents:()=>br,removeEntity:()=>Fe,removeQuery:()=>cr,resetChangedQuery:()=>ur,resetGlobals:()=>Lt,resetWorld:()=>Cr,setDefaultSize:()=>gr,setRemovedRecycleThreshold:()=>Tr,worlds:()=>v});module.exports=Kr(Wn);var ht={};X(ht,{$componentCount:()=>Ee,$componentMap:()=>S,$schema:()=>bt});var S=Symbol("componentMap"),Ee=Symbol("componentCount"),bt=Symbol("schema");var St={};X(St,{$dirtyQueries:()=>q,$enterQuery:()=>tn,$exitQuery:()=>rn,$modifier:()=>j,$notQueries:()=>J,$queries:()=>D,$queriesHashMap:()=>Z,$queryComponents:()=>ge,$queryDataMap:()=>E,$querySparseSet:()=>en,$queueRegisters:()=>pe});var j=Symbol("$modifier"),D=Symbol("queries"),J=Symbol("notQueries"),Z=Symbol("queriesHashMap"),en=Symbol("querySparseSet"),pe=Symbol("queueRegisters"),E=Symbol("queryDataMap"),q=Symbol("$dirtyQueries"),ge=Symbol("queryComponents"),tn=Symbol("enterQuery"),rn=Symbol("exitQuery");var xt={};X(xt,{$entityArray:()=>B,$entityComponents:()=>W,$entityIndices:()=>nn,$entityMasks:()=>$,$entitySparseSet:()=>g,$removedEntities:()=>on});var $=Symbol("entityMasks"),W=Symbol("entityComponents"),g=Symbol("entitySparseSet"),B=Symbol("entityArray"),nn=Symbol("entityIndices"),on=Symbol("removedEntities");var Et={};X(Et,{$prefabComponents:()=>Xe,$worldToPrefab:()=>I});var Xe=Symbol("prefabComponents"),I=Symbol("worldToPrefab");var M=()=>{let e=[],t=[],r=i=>e[t[i]]===i;return{add:i=>{r(i)||(t[i]=e.push(i)-1)},remove:i=>{if(!r(i))return;let a=t[i],f=e.pop();f!==i&&(e[a]=f,t[f]=a)},has:r,sparse:t,dense:e,reset:()=>{e.length=0,t.length=0},sort:()=>{e.sort((i,a)=>i-a);for(let i=0;i<e.length;i++)t[e[i]]=i}}};var gt=!1,Tt=!1;function me(){if(gt)return Tt;try{return new SharedArrayBuffer(1),Tt=!0,gt=!0,!0}catch{return Tt=!1,gt=!0,!1}}function $t(){return me()?"grow"in SharedArrayBuffer.prototype:"resize"in ArrayBuffer.prototype}var Vt=(e,t,r=!1)=>{if(e instanceof ArrayBuffer){if($t()&&!r)return e.resize(t*Uint32Array.BYTES_PER_ELEMENT),e;{let n=new ArrayBuffer(t*Uint32Array.BYTES_PER_ELEMENT);return new Uint32Array(n).set(new Uint32Array(e)),n}}else{if($t()&&!r)return e.grow(t*Uint32Array.BYTES_PER_ELEMENT),e;{let n=new SharedArrayBuffer(t*Uint32Array.BYTES_PER_ELEMENT);return new Uint32Array(n).set(new Uint32Array(e)),n}}};var Ct={};X(Ct,{$buffer:()=>U,$dense:()=>F,$length:()=>Q,$lengthBuffer:()=>Ot,$maxCapacity:()=>Je,$onGrowCbs:()=>Ce});var F=Symbol("dense"),Q=Symbol("length"),U=Symbol("buffer"),Ot=Symbol("lengthBuffer"),Je=Symbol("maxCapacity"),Ce=Symbol("onGrowCbs");function Xt(e,t=e){let r=me()?new SharedArrayBuffer(e*Uint32Array.BYTES_PER_ELEMENT,{maxByteLength:t*Uint32Array.BYTES_PER_ELEMENT}):new ArrayBuffer(e*Uint32Array.BYTES_PER_ELEMENT,{maxByteLength:t*Uint32Array.BYTES_PER_ELEMENT}),n=me()?new SharedArrayBuffer(Uint32Array.BYTES_PER_ELEMENT):new ArrayBuffer(Uint32Array.BYTES_PER_ELEMENT),o=new Uint32Array(r),s=new Array(e),u=new Uint32Array(n,0,1);return{[F]:o,[U]:r,[Ot]:n,[Je]:t,[Ce]:new Set,get[Q](){return u[0]},set[Q](i){u[0]=i},sparse:s,get dense(){return tr(this)}}}function Jt(e,t){e[Q]+1>e[F].length&&er(e,Math.max(t,Math.min(e[Q]*2,e[Je])));let r=e[Q];e.sparse[t]===void 0&&(e[F][r]=t,e.sparse[t]=r,e[Q]++)}function Zt(e,t){return e.sparse[t]<e[Q]&&e[F][e.sparse[t]]===t}function Kt(e,t){if(Zt(e,t)){let r=e.sparse[t];e[F][r]=e[F][e[Q]-1],e.sparse[e[F][r]]=r,delete e.sparse[t],e[Q]--}}function er(e,t){let r=e[U],n=r.byteLength;e[U]=Vt(e[U],t),e[F]=new Uint32Array(e[U]);let o={prevBuffer:r,prevSize:n,newBuffer:e[U],newSize:e[U].byteLength,didGrowInPlace:r===e[U]};for(let s of e[Ce])s(o)}function sn(e){return e[Q]}function tr(e){return new Uint32Array(e[U],0,e[Q])}function an(e,t){return e[Ce].add(t),()=>e[Ce].delete(t)}var Ye={create:Xt,add:Jt,remove:Kt,has:Zt,grow:er,length:sn,dense:tr,onGrow:an};var kn={...Ct};var le={i8:"i8",ui8:"ui8",ui8c:"ui8c",i16:"i16",ui16:"ui16",i32:"i32",ui32:"ui32",f32:"f32",f64:"f64",eid:"eid"},At={i8:"Int8",ui8:"Uint8",ui8c:"Uint8Clamped",i16:"Int16",ui16:"Uint16",i32:"Int32",ui32:"Uint32",eid:"Uint32",f32:"Float32",f64:"Float64"},K={i8:Int8Array,ui8:Uint8Array,ui8c:Uint8ClampedArray,i16:Int16Array,ui16:Uint16Array,i32:Int32Array,ui32:Uint32Array,f32:Float32Array,f64:Float64Array,eid:Uint32Array},Wt={uint8:2**8,uint16:2**16,uint32:2**32},Ae=Object.freeze([]);var Bt={};X(Bt,{$indexBytes:()=>be,$indexType:()=>de,$isEidType:()=>Te,$parentArray:()=>Me,$queryShadow:()=>fn,$serializeShadow:()=>pn,$storeArrayElementCounts:()=>Ze,$storeBase:()=>ee,$storeFlattened:()=>O,$storeMaps:()=>Qt,$storeRef:()=>Mt,$storeSize:()=>ke,$storeSubarrays:()=>We,$storeType:()=>Rt,$subarray:()=>Dt,$subarrayCursors:()=>Ke,$subarrayFrom:()=>un,$subarrayTo:()=>cn,$tagStore:()=>ye});var Mt=Symbol("storeRef"),ke=Symbol("storeSize"),Qt=Symbol("storeMaps"),O=Symbol("storeFlattened"),ee=Symbol("storeBase"),Rt=Symbol("storeType"),Ze=Symbol("storeArrayElementCounts"),We=Symbol("storeSubarrays"),Ke=Symbol("subarrayCursors"),Dt=Symbol("subarray"),un=Symbol("subarrayFrom"),cn=Symbol("subarrayTo"),Me=Symbol("parentArray"),ye=Symbol("tagStore"),fn=Symbol("queryShadow"),pn=Symbol("serializeShadow"),de=Symbol("indexType"),be=Symbol("indexBytes"),Te=Symbol("isEidType");var mn=e=>t=>Math.ceil(t/e)*e,ln=mn(4),te={};var et=(e,t)=>{if(ArrayBuffer.isView(e))e[t]=e.slice(0);else{let r=e[Me].slice(0);e[t]=e.map((n,o)=>{let{length:s}=e[o],u=s*o,i=u+s;return r.subarray(u,i)})}};var Pt=(e,t)=>{e[O]&&e[O].forEach(r=>{ArrayBuffer.isView(r)?r[t]=0:r[t].fill(0)})},yn=(e,t)=>{let r=t*K[e].BYTES_PER_ELEMENT,n=me()?new SharedArrayBuffer(r):new ArrayBuffer(r),o=new K[e](n);return o[Te]=e===le.eid,o},nr=e=>e[Me],dn=(e,t,r)=>{let n=e[ke],o=Array(n).fill(0);o[Rt]=t,o[Te]=t===le.eid;let s=e[Ke],u=r<=Wt.uint8?le.ui8:r<=Wt.uint16?le.ui16:le.ui32;if(!r)throw new Error("bitECS - Must define component array length");if(!K[t])throw new Error(`bitECS - Invalid component array property type ${t}`);if(!e[We][t]){let f=e[Ze][t],m=ln(f*n)*K[t].BYTES_PER_ELEMENT,p=me()?new SharedArrayBuffer(m):new ArrayBuffer(m),R=new K[t](p);R[de]=At[u],R[be]=K[u].BYTES_PER_ELEMENT,e[We][t]=R}let i=s[t],a=i+n*r;s[t]=a,o[Me]=e[We][t].subarray(i,a);for(let f=0;f<n;f++){let m=r*f,p=m+r;o[f]=o[Me].subarray(m,p),o[f][de]=At[u],o[f][be]=K[u].BYTES_PER_ELEMENT,o[f][Dt]=!0}return o},rr=e=>Array.isArray(e)&&typeof e[0]=="string"&&typeof e[1]=="number",or=(e,t)=>{let r=Symbol("store");if(!e||!Object.keys(e).length)return te[r]={[ke]:t,[ye]:!0,[ee]:()=>te[r]},te[r];e=JSON.parse(JSON.stringify(e));let n={},o=u=>{let i=Object.keys(u);for(let a of i)rr(u[a])?(n[u[a][0]]||(n[u[a][0]]=0),n[u[a][0]]+=u[a][1]):u[a]instanceof Object&&o(u[a])};o(e);let s={[ke]:t,[Qt]:{},[We]:{},[Mt]:r,[Ke]:Object.keys(K).reduce((u,i)=>({...u,[i]:0}),{}),[O]:[],[Ze]:n};if(e instanceof Object&&Object.keys(e).length){let u=(i,a)=>{if(typeof i[a]=="string")i[a]=yn(i[a],t),i[a][ee]=()=>te[r],s[O].push(i[a]);else if(rr(i[a])){let[f,m]=i[a];i[a]=dn(s,f,m),i[a][ee]=()=>te[r],s[O].push(i[a])}else i[a]instanceof Object&&(i[a]=Object.keys(i[a]).reduce(u,i[a]));return i};return te[r]=Object.assign(Object.keys(e).reduce(u,e),s),te[r][ee]=()=>te[r],te[r]}};var Qe=(e,t)=>t.sort((r,n)=>{typeof r=="function"&&r[j]&&(r=r()[0]),typeof n=="function"&&n[j]&&(n=n()[0]),e[S].has(r)||_(e,r),e[S].has(n)||_(e,n);let o=e[S].get(r),s=e[S].get(n);return o.id>s.id?1:-1}).reduce((r,n)=>{let o;typeof n=="function"&&n[j]&&(o=n()[1],n=n()[0]),e[S].has(n)||_(e,n);let s=e[S].get(n);return o?r+=`-${o}(${s.id})`:r+=`-${s.id}`,r},"");var vt={};X(vt,{$archetypes:()=>Le,$bitflag:()=>H,$bufferQueries:()=>Y,$localEntities:()=>re,$localEntityLookup:()=>V,$manualEntityRecycling:()=>z,$size:()=>P});var P=Symbol("size"),H=Symbol("bitflag"),Le=Symbol("archetypes"),re=Symbol("localEntities"),V=Symbol("localEntityLookup"),z=Symbol("manualEntityRecycling"),Y=Symbol("bufferQueries");var we=[];function sr(e,t){let r=()=>[e,t];return r[j]=!0,r}var ir=e=>sr(e,"not");var ar=e=>sr(e,"changed");function bn(...e){return function(){return e}}function hn(...e){return function(){return e}}function Sn(...e){return function(){return e}}var $e=(e,t)=>{if(e[E].has(t))return;let r=[],n=[],o=[];t[ge].forEach(c=>{if(typeof c=="function"&&c[j]){let[h,N]=c();e[S].has(h)||_(e,h),N==="not"&&n.push(h),N==="changed"&&(o.push(h),r.push(h))}else e[S].has(c)||_(e,c),r.push(c)});let s=c=>e[S].get(c),u=r.concat(n).map(s),i;if(e[Y]){let c=e[P]===-1?1e5:e[P]*2;i=Ye.create(1024,c>1024?c:1024)}else i=M();let a=[],f=[],m=M(),p=[M()],R=[M()],w=u.map(c=>c.generationId).reduce((c,h)=>(c.includes(h)||c.push(h),c),[]),d=(c,h)=>(c[h.generationId]||(c[h.generationId]=0),c[h.generationId]|=h.bitflag,c),x=r.map(s).reduce(d,{}),Se=n.map(s).reduce(d,{}),y=u.reduce(d,{}),xe=r.filter(c=>!c[ye]).map(c=>Object.getOwnPropertySymbols(c).includes(O)?c[O]:[c]).reduce((c,h)=>c.concat(h),[]),T=Object.assign(i,{archetypes:a,changed:f,components:r,notComponents:n,changedComponents:o,allComponents:u,masks:x,notMasks:Se,hasMasks:y,generations:w,flatProps:xe,toRemove:m,enterQueues:p,exitQueues:R,shadows:[],query:t});e[E].set(t,T),e[D].add(T);let l=Qe(e,t[ge]);e[Z].set(l,T),u.forEach(c=>{c.queries.add(T)}),n.length&&e[J].add(T),t[pe].forEach(c=>c(e));for(let c=0;c<mr();c++){if(!e[g].has(c)||k(e,Oe,c))continue;Be(e,T,c)&&Pe(T,c)}},xn=(e,t)=>{let r=Symbol(),n=e.flatProps[t];return et(n,r),e.shadows[t]=n[r],n[r]},En=(e,t)=>{t&&(e.changed=[]);let{flatProps:r,shadows:n}=e;for(let o=0;o<e.dense.length;o++){let s=e.dense[o],u=!1;for(let i=0;i<r.length;i++){let a=r[i],f=n[i]||xn(e,i);if(ArrayBuffer.isView(a[s])){for(let m=0;m<a[s].length;m++)if(a[s][m]!==f[s][m]){u=!0;break}f[s].set(a[s])}else a[s]!==f[s]&&(u=!0,f[s]=a[s])}u&&e.changed.push(s)}return e.changed},gn=(e,t)=>e.concat(t),Gt=e=>t=>t.filter(r=>r.name===e().constructor.name).reduce(gn),yo=Gt(bn),bo=Gt(hn),ho=Gt(Sn),Re=e=>{if(e===void 0){let r=function(n){return n[Y]?new Uint32Array(n[B]):Array.from(n[B])};return r[ge]=e,r[pe]=[],r}let t=function(r,n=!0){let o=r[E].get(t);return It(r),o.changedComponents.length?En(o,n):o.changedComponents.length?o.changed.dense:r[Y]?o.dense:Array.from(o.dense)};return t[ge]=e,t[pe]=[],we.push(t),v.forEach(r=>$e(r,t)),t};function De(e,t){if(Array.isArray(t)){let r=t,n=Qe(e,r),o=e[Z].get(n);return o?o.query(e):Re(r)(e)}else{let r=t;return e[Y]?new Uint32Array(r(e)):Array.from(r(e))}}var Be=(e,t,r)=>{let{masks:n,notMasks:o,generations:s}=t;for(let u=0;u<s.length;u++){let i=s[u],a=n[i],f=o[i],m=e[$][i][r];if(f&&m&f||a&&(m&a)!==a)return!1}return!0};var Pe=(e,t)=>{e.toRemove.remove(t);for(let r=0;r<e.enterQueues.length;r++)e.enterQueues[r].add(t);for(let r=0;r<e.exitQueues.length;r++)e.exitQueues[r].remove(t);e.dense instanceof Uint32Array?Ye.add(e,t):e.add(t)},Tn=e=>{for(let t=e.toRemove.dense.length-1;t>=0;t--){let r=e.toRemove.dense[t];e.toRemove.remove(r),e.dense instanceof Uint32Array?Ye.remove(e,r):e.remove(r)}},It=e=>{e[q].size&&(e[q].forEach(Tn),e[q].clear())},Ne=(e,t,r)=>{if(!(!(e[Y]?Ye.has(t,r):t.has(r))||t.toRemove.has(r))){t.toRemove.add(r),e[q].add(t);for(let o=0;o<t.exitQueues.length;o++)t.exitQueues[o].add(r);for(let o=0;o<t.enterQueues.length;o++)t.enterQueues[o].remove(r)}},ur=(e,t)=>{let r=e[E].get(t);r.changed=[]},cr=(e,t)=>{let r=e[E].get(t);e[D].delete(r),e[E].delete(t);let n=Qe(e,t[ge]);e[Z].delete(n)},fr=e=>t=>{t[E].has(e)||$e(t,e);let r=t[E].get(e);if(r.enterQueues[0].dense.length===0)return Ae;{let n=r.enterQueues[0].dense.slice();return r.enterQueues[0].reset(),n}},pr=e=>t=>{t[E].has(e)||$e(t,e);let r=t[E].get(e);if(r.exitQueues[0].dense.length===0)return Ae;{let n=r.exitQueues[0].dense.slice();return r.exitQueues[0].reset(),n}};var ne=(e,t,r)=>Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0,configurable:!0}),tt=(e,t)=>{let r={enumerable:!1,writable:!0,configurable:!0};Object.defineProperties(e,Reflect.ownKeys(t).reduce((n,o)=>Object.assign(n,{[o]:{value:t[o],...r}}),{}))};var Ut={};X(Ut,{$autoRemoveSubject:()=>qe,$exclusiveRelation:()=>je,$initStore:()=>nt,$isPairComponent:()=>he,$onTargetRemoved:()=>ve,$pairTarget:()=>C,$pairsMap:()=>rt,$relation:()=>oe,$relationTargetEntities:()=>se});var rt=Symbol("pairsMap"),he=Symbol("isPairComponent"),oe=Symbol("relation"),C=Symbol("pairTarget"),ve=Symbol("onTargetRemoved"),je=Symbol("exclusiveRelation"),qe=Symbol("autoRemoveSubject"),se=Symbol("relationTargetEntities"),nt=Symbol("initStore");function lr(e,t,r,n){if(!r.has(n)){let o=t();ne(o,he,!0),ne(o,oe,e),ne(o,C,n),r.set(n,o)}return r.get(n)}var _t=e=>{let t=e?.initStore||(()=>({})),r=new Map,n=function(o){if(o===void 0)throw Error("Relation target is undefined");return o==="*"&&(o=A),lr(n,t,r,o)};return ne(n,rt,r),ne(n,nt,t),ne(n,je,e&&e.exclusive),ne(n,qe,e&&e.autoRemoveSubject),ne(n,ve,e?e.onTargetRemoved:void 0),n},ie=(e,t)=>{if(e===void 0)throw Error("Relation is undefined");if(t===void 0)throw Error("Relation target is undefined");t==="*"&&(t=A);let r=e[rt],n=e[nt];return lr(e,n,r,t)},A=_t(),Ge=_t(),Ie=(e,t,r)=>{let n=Ue(e,r),o=[];for(let s of n)if(s[oe]===t&&s[C]!==A)if(typeof s[C]=="object"&&s[C][I]){let u=s[C][I].get(e);u==null&&(u=ot(e,s[C])),o.push(u)}else o.push(s[C]);return o};var st=(e={},t)=>{let r=or(e,t||at());return e&&Object.keys(e).length&&(r[bt]=e),r},_=(e,t)=>{if(!t)throw new Error("bitECS - Cannot register null or undefined component");let r=new Set,n=new Set,o=new Set;e[D].forEach(u=>{u.allComponents.includes(t)&&r.add(u)});let s={id:e[Ee]++,generationId:e[$].length-1,bitflag:e[H],ref:t,queries:r,notQueries:n,changedQueries:o};e[S].set(t,s),hr(e)},yr=(e,t)=>{t.forEach(r=>_(e,r))},k=(e,t,r)=>{let n=e[S].get(t);if(!n)return!1;let{generationId:o,bitflag:s}=n;return(e[$][o][r]&s)===s},dr=(e,t,r)=>{r instanceof Object&&(r=r[I].get(e)),L(e,Ge(r),t);let n=Ue(e,r);for(let s of n){if(s===Oe)continue;L(e,s,t);let u=Object.keys(s);for(let i of u)s[i][t]=s[i][r]}let o=Ie(e,Ge,r);for(let s of o)dr(e,t,s)},L=(e,t,r,n=!1)=>{if(!zt(e,r))throw new Error("bitECS - entity does not exist in the world.");if(e[S].has(t)||_(e,t),k(e,t,r))return;let o=e[S].get(t),{generationId:s,bitflag:u,queries:i}=o;if(e[$][s][r]|=u,k(e,Oe,r)||i.forEach(a=>{a.toRemove.remove(r),Be(e,a,r)?Pe(a,r):Ne(e,a,r)}),e[W].get(r).add(t),n&&Pt(t,r),t[he]){let a=t[oe];L(e,ie(a,A),r);let f=t[C];if(L(e,ie(A,f),r),a[je]===!0&&f!==A){let m=Ie(e,a,r)[0];m&&m!==f&&ae(e,a(m),r)}if(e[se].add(f),a===Ge){let m=Ie(e,Ge,r);for(let p of m)dr(e,r,p)}}},it=(e,t,r,n=!1)=>{t.forEach(o=>L(e,o,r,n))},ae=(e,t,r,n=!0)=>{if(!zt(e,r))throw new Error("bitECS - entity does not exist in the world.");if(!k(e,t,r))return;let o=e[S].get(t),{generationId:s,bitflag:u,queries:i}=o;if(e[$][s][r]&=~u,i.forEach(a=>{a.toRemove.remove(r),Be(e,a,r)?Pe(a,r):Ne(e,a,r)}),e[W].get(r).delete(t),n&&Pt(t,r),t[he]){De(e,[A(r)]).length===0&&e[se].remove(r);let a=t[C];ae(e,ie(A,a),r);let f=t[oe];Ie(e,f,r).length===0&&ae(e,ie(f,A),r)}},br=(e,t,r,n=!0)=>{t.forEach(o=>ae(e,o,r,n))};var ft=1e5,Yt=0,pt=ft,at=()=>pt,ze=[],_e=[],ut=[],$n=()=>{if(_e.length===0)for(;ze.length>0;)_e.push(ze.pop());if(_e.length===0)throw new Error("Queue is empty");return _e.pop()},Sr=()=>ze.length+_e.length,xr=.01,kt=xr,Lt=()=>{pt=ft,Yt=0,kt=xr,ze.length=0,_e.length=0,ut.length=0,we.length=0,v.length=0},Er=()=>ft,gr=e=>{ft=e,Lt(),pt=e},Tr=e=>{kt=e},mr=()=>Yt;var wt=new Map,$r=e=>{if(!e[z])throw new Error("bitECS - cannot flush removed entities, enable feature with the enableManualEntityRecycling function");ze.push(...ut),ut.length=0},Oe=st(),ue=e=>{let t;if(e[z]&&Sr()>0||!e[z]&&Sr()>Math.round(pt*kt)?t=$n():t=Yt++,e[P]!==-1&&e[g].dense.length>=e[P])throw new Error("bitECS - max entities reached");return e[g].add(t),wt.set(t,e),e[J].forEach(r=>{Be(e,r,t)&&Pe(r,t)}),e[W].set(t,new Set),t},Fe=(e,t)=>{if(e[g].has(t)){if(e[se].has(t)){for(let r of De(e,[ie(A,t)]))if(ct(e,r)){ae(e,ie(A,t),r);for(let n of e[W].get(r)){if(!n[he]||!ct(e,r))continue;let o=n[oe];n[C]===t&&(ae(e,n,r),o[qe]&&Fe(e,r),o[ve]&&o[ve](e,r,t))}}}for(let r of e[D])Ne(e,r,t);e[z]?ut.push(t):ze.push(t),e[g].remove(t),e[W].delete(t),e[re].delete(e[V].get(t)),e[V].delete(t);for(let r=0;r<e[$].length;r++)e[$][r][t]=0}},Ue=(e,t)=>{if(t===void 0)throw new Error("bitECS - entity is undefined.");if(!e[g].has(t))throw new Error("bitECS - entity does not exist in the world.");return Array.from(e[W].get(t))},ct=(e,t)=>e[g].has(t);var v=[];function Nt(...e){let t=typeof e[0]=="object"?e[0]:{},r=typeof e[0]=="number"?e[0]:typeof e[1]=="number"?e[1]:-1,n=M();return tt(t,{[P]:r,[$]:[r===-1?new Array:new Array(r)],[W]:new Map,[Le]:[],[g]:n,[B]:n.dense,[H]:1,[S]:new Map,[Ee]:0,[E]:new Map,[D]:new Set,[Z]:new Map,[J]:new Set,[q]:new Set,[re]:new Map,[V]:new Map,[z]:!1,[se]:M()}),t}function jt(e){v.push(e),we.forEach(t=>$e(e,t))}function Or(...e){let t=Nt(...e);return jt(t),t}var Cr=(e,t=at())=>(e[P]=t,e[B]&&e[B].forEach(r=>Fe(e,r)),e[$]=[t===-1?new Array:new Array(t)],e[W]=new Map,e[Le]=[],e[g]=M(),e[B]=e[g].dense,e[H]=1,e[S]=new Map,e[Ee]=0,e[E]=new Map,e[D]=new Set,e[Z]=new Map,e[J]=new Set,e[q]=new Set,e[re]=new Map,e[V]=new Map,e[z]=!1,e[Y]=!1,e),Ar=e=>{let t=e;delete t[P],delete t[$],delete t[W],delete t[Le],delete t[g],delete t[B],delete t[H],delete t[S],delete t[Ee],delete t[E],delete t[D],delete t[Z],delete t[J],delete t[q],delete t[re],delete t[V],delete t[se],delete t[z],delete t[Y];let r=v.indexOf(e);r!==-1&&v.splice(r,1)},Wr=e=>Array.from(e[S].keys()),Mr=e=>e[g].dense.slice(0),hr=e=>{let t=e[P];e[H]*=2,e[H]>=2**31&&(e[H]=1,e[$].push(t===-1?new Array:new Array(t)))},zt=(e,t)=>e[g].has(t),Qr=e=>(e[z]=!0,e),Rr=e=>(e[Y]=!0,e);var Dr=e=>(t,...r)=>(e(t,...r),t);function Br(e){let t=typeof e=="function"?e:Re(e),r=-1,n=s=>{let u=s[E].get(t);u&&(r=u.enterQueues.push(M())-1)};for(let s of v)n(s);let o=(s,u=!0)=>{let i=s[E].get(t);if(i.enterQueues[r].dense.length===0)return Ae;{let a=i.enterQueues[r].dense.slice();return u&&i.enterQueues[r].reset(),a}};return t[pe].push(n),o}function Pr(e){let t=typeof e=="function"?e:Re(e),r=-1,n=s=>{let u=s[E].get(t);u&&(r=u.exitQueues.push(M())-1)};for(let s of v)n(s);let o=(s,u=!0)=>{let i=s[E].get(t);if(r===-1&&(r=i.exitQueues.push(M())-1),i.exitQueues[r].dense.length===0)return Ae;{let a=i.exitQueues[r].dense.slice();return u&&i.exitQueues[r].reset(),a}};return t[pe].push(n),o}var He={REPLACE:0,APPEND:1,MAP:2},mt=!1;var vr=(e,t)=>e.concat(t),zr=e=>t=>!e(t),qt=e=>e[O],Ft=qt,Gr=zr(Ft),Yr=e=>typeof e=="function"&&e[j],Ir=zr(Yr),Ur=e=>Yr(e)&&e()[1]==="changed",kr=e=>Object.getOwnPropertySymbols(e).includes(S),_r=e=>e()[0],lt=e=>{if(kr(e))return[[],new Map];let t=e.filter(Ir).filter(Ft).map(qt).reduce(vr,[]),r=e.filter(Ur).map(_r).filter(Ft).map(qt).reduce(vr,[]),n=e.filter(Ir).filter(Gr),o=e.filter(Ur).map(_r).filter(Gr),s=[...t,...n,...r,...o],u=[...r,...o].reduce((i,a)=>{let f=Symbol();return et(a,f),i.set(a,f),i},new Map);return[s,u]},Lr=(e,t=2e7)=>{let r=kr(e),[n,o]=lt(e),s=new ArrayBuffer(t),u=new DataView(s),i=new Map;return f=>{mt&&([n,o]=lt(e),mt=!1),r&&(n=[],e[S].forEach((w,d)=>{d[O]?n.push(...d[O]):n.push(d)}));let m;Object.getOwnPropertySymbols(f).includes(S)?(m=f,f=f[B]):m=wt.get(f[0]);let p=0;if(!f.length)return s.slice(0,p);let R=new Map;for(let w=0;w<n.length;w++){let d=n[w],x=d[ee](),Se=o.get(d),y=Se?d[Se]:null;R.has(x)||R.set(x,new Map),u.setUint8(p,w),p+=1;let xe=p;p+=4;let b=0;for(let T=0;T<f.length;T++){let l=f[T],c=i.get(l);c||(c=i.set(l,new Set).get(l)),c.add(l);let h=y&&R.get(x).get(l)||!c.has(x)&&k(m,x,l);if(R.get(x).set(l,h),h)c.add(x);else if(!k(m,x,l)){c.delete(x);continue}let N=p;if(u.setUint32(p,l),p+=4,d[ye]){b++;continue}if(ArrayBuffer.isView(d[l])){let ce=d[l].constructor.name.replace("Array",""),Ve=d[l][de],Ht=d[l][be],qr=p;p+=Ht;let yt=0;for(let fe=0;fe<d[l].length;fe++){if(y){let Hr=y[l][fe]!==d[l][fe];if(y[l][fe]=d[l][fe],!Hr&&!h)continue}u[`set${Ve}`](p,fe),p+=Ht;let Fr=d[l][fe];u[`set${ce}`](p,Fr),p+=d[l].BYTES_PER_ELEMENT,yt++}if(yt>0)u[`set${Ve}`](qr,yt),b++;else{p=N;continue}}else{if(y){let Ve=y[l]!==d[l];if(y[l]=d[l],!Ve&&!h){p=N;continue}}let ce=d.constructor.name.replace("Array","");u[`set${ce}`](p,d[l]),p+=d.BYTES_PER_ELEMENT,b++}}b>0?u.setUint32(xe,b):p-=5}return s.slice(0,p)}},G=new Map,wr=e=>{let t=Object.getOwnPropertySymbols(e).includes(S),[r]=lt(e),n=new Set;return(s,u,i=0)=>{G.clear(),mt&&([r]=lt(e),mt=!1),t&&(r=[],e[S].forEach((w,d)=>{d[O]?r.push(...d[O]):r.push(d)}));let a=s[re],f=s[V],m=new DataView(u),p=0;for(;p<u.byteLength;){let w=m.getUint8(p);p+=1;let d=m.getUint32(p);p+=4;let x=r[w];for(let Se=0;Se<d;Se++){let y=m.getUint32(p);if(p+=4,i===He.MAP)if(a.has(y))y=a.get(y);else if(G.has(y))y=G.get(y);else{let b=ue(s);a.set(y,b),f.set(b,y),G.set(y,b),y=b}if(i===He.APPEND||i===He.REPLACE&&!s[g].has(y)){let b=G.get(y)||ue(s);G.set(y,b),y=b}let xe=x[ee]();if(k(s,xe,y)||L(s,xe,y),n.add(y),!xe[ye])if(ArrayBuffer.isView(x[y])){let b=x[y],T=m[`get${b[de]}`](p);p+=b[be];for(let l=0;l<T;l++){let c=m[`get${b[de]}`](p);p+=b[be];let h=m[`get${b.constructor.name.replace("Array","")}`](p);if(p+=b.BYTES_PER_ELEMENT,x[Te]){let N;if(a.has(h))N=a.get(h);else if(G.has(h))N=G.get(h);else{let ce=ue(s);a.set(h,ce),f.set(ce,h),G.set(h,ce),N=ce}x[y][c]=N}else x[y][c]=h}}else{let b=m[`get${x.constructor.name.replace("Array","")}`](p);if(p+=x.BYTES_PER_ELEMENT,x[Te]){let T;if(a.has(b))T=a.get(b);else if(G.has(b))T=G.get(b);else{let l=ue(s);a.set(b,l),f.set(l,b),G.set(b,l),T=l}x[y]=T}else x[y]=b}}}let R=Array.from(n);return n.clear(),R}};var Nr=(...e)=>t=>{let r=t;for(let n=0;n<e.length;n++){let o=e[n];r=o(r)}return r};var On=(e=[])=>{let t={};return tt(t,{[Xe]:e,[I]:new Map}),t},ot=(e,t)=>{if(t[I].has(e))return t[I].get(e);let r=jr(e);return it(e,t[Xe],r),t[I].set(e,r),r},Cn=(e,t)=>t.map(r=>ot(e,r)),jr=e=>{let t=ue(e);return L(e,Oe,t),t};var An={...vt,...xt,...ht,...St,...Bt,...Ut,...Et};0&&(module.exports={Changed,DESERIALIZE_MODE,IsA,Not,Pair,SYMBOLS,Types,Wildcard,addComponent,addComponents,addEntity,addPrefab,archetypeHash,commitRemovals,createWorld,defineComponent,defineDeserializer,defineEnterQueue,defineExitQueue,definePrefab,defineQuery,defineRelation,defineSerializer,defineSystem,defineWorld,deleteWorld,enableBufferedQueries,enableManualEntityRecycling,enterQuery,entityExists,exitQuery,flushRemovedEntities,getAllEntities,getDefaultSize,getEntityComponents,getRelationTargets,getWorldComponents,hasComponent,parentArray,pipe,query,registerComponent,registerComponents,registerPrefab,registerPrefabs,registerQuery,registerWorld,removeComponent,removeComponents,removeEntity,removeQuery,resetChangedQuery,resetGlobals,resetWorld,setDefaultSize,setRemovedRecycleThreshold,worlds});
