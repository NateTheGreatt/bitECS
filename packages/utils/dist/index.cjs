"use strict";var U=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var D=Object.prototype.hasOwnProperty;var L=(e,r)=>{for(var n in r)U(e,n,{get:r[n],enumerable:!0})},j=(e,r,n,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of V(r))!D.call(e,o)&&o!==n&&U(e,o,{get:()=>r[o],enumerable:!(t=k(r,o))||t.enumerable});return e};var q=e=>j(U({},"__esModule",{value:!0}),e);var te={};L(te,{SYMBOLS:()=>ne,createSpatialGrid:()=>K,createUint32SparseSet:()=>_,isSabSupported:()=>S,sparseSetAdd:()=>Y,sparseSetGetDense:()=>z,sparseSetGetLength:()=>F,sparseSetGrow:()=>P,sparseSetHas:()=>O,sparseSetOnGrow:()=>J,sparseSetRemove:()=>$,spatialGridAdd:()=>X,spatialGridBroadphaseCell:()=>re,spatialGridBroadphasePosition:()=>Z,spatialGridBroadphaseRadius:()=>W,spatialGridBroadphaseView:()=>ee,spatialGridGetCell:()=>w,spatialGridGetCellX:()=>N,spatialGridGetCellY:()=>v,spatialGridInBounds:()=>A,spatialGridIndexOf:()=>E,spatialGridRefresh:()=>Q,spatialGridRemove:()=>H,spatialGridToCell:()=>c});module.exports=q(te);var I=!1,M=!1;function S(){if(I)return M;try{return new SharedArrayBuffer(1),M=!0,I=!0,!0}catch{return M=!1,I=!0,!1}}function C(){return S()?"grow"in SharedArrayBuffer.prototype:"resize"in ArrayBuffer.prototype}var R=(e,r,n=!1)=>{if(e instanceof ArrayBuffer){if(C()&&!n)return e.resize(r*Uint32Array.BYTES_PER_ELEMENT),e;{let t=new ArrayBuffer(r*Uint32Array.BYTES_PER_ELEMENT);return new Uint32Array(t).set(new Uint32Array(e)),t}}else{if(C()&&!n)return e.grow(r*Uint32Array.BYTES_PER_ELEMENT),e;{let t=new SharedArrayBuffer(r*Uint32Array.BYTES_PER_ELEMENT);return new Uint32Array(t).set(new Uint32Array(e)),t}}};var T={};L(T,{$buffer:()=>f,$dense:()=>d,$length:()=>u,$lengthBuffer:()=>g,$maxCapacity:()=>B,$onGrowCbs:()=>G});var d=Symbol("dense"),u=Symbol("length"),f=Symbol("buffer"),g=Symbol("lengthBuffer"),B=Symbol("maxCapacity"),G=Symbol("onGrowCbs");function _(e,r=e){let n=S()?new SharedArrayBuffer(e*Uint32Array.BYTES_PER_ELEMENT,{maxByteLength:r*Uint32Array.BYTES_PER_ELEMENT}):new ArrayBuffer(e*Uint32Array.BYTES_PER_ELEMENT,{maxByteLength:r*Uint32Array.BYTES_PER_ELEMENT}),t=S()?new SharedArrayBuffer(Uint32Array.BYTES_PER_ELEMENT):new ArrayBuffer(Uint32Array.BYTES_PER_ELEMENT),o=new Uint32Array(n),i=new Array(e),a=new Uint32Array(t,0,1);return{[d]:o,[f]:n,[g]:t,[B]:r,[G]:new Set,get[u](){return a[0]},set[u](p){a[0]=p},sparse:i,get dense(){return z(this)}}}function Y(e,r){e[u]+1>e[d].length&&P(e,Math.max(r,Math.min(e[u]*2,e[B])));let n=e[u];e.sparse[r]===void 0&&(e[d][n]=r,e.sparse[r]=n,e[u]++)}function O(e,r){return e.sparse[r]<e[u]&&e[d][e.sparse[r]]===r}function $(e,r){if(O(e,r)){let n=e.sparse[r];e[d][n]=e[d][e[u]-1],e.sparse[e[d][n]]=n,delete e.sparse[r],e[u]--}}function P(e,r){let n=e[f],t=n.byteLength;e[f]=R(e[f],r),e[d]=new Uint32Array(e[f]);let o={prevBuffer:n,prevSize:t,newBuffer:e[f],newSize:e[f].byteLength,didGrowInPlace:n===e[f]};for(let i of e[G])i(o)}function F(e){return e[u]}function z(e){return new Uint32Array(e[f],0,e[u])}function J(e,r){return e[G].add(r),()=>e[G].delete(r)}function K(e){let{cellsHigh:r,cellsWide:n,gridWidth:t,gridHeight:o,cellSize:i,defaultCellLength:a=10}=e;if(r!==void 0&&n!==void 0)t=n*i,o=r*i;else if(t!==void 0&&o!==void 0)n=Math.ceil(t/i),r=Math.ceil(o/i);else throw new Error("Invalid spatial grid options");let p=Array(n*r).fill(null).map(()=>_(a));return{cellSize:i,cells:p,width:t,height:o,cellsWide:n,cellsHigh:r}}function c(e,r){return Math.floor(r/e.cellSize)}function E(e,r,n){return r+e.cellsHigh*n}function w(e,r,n){return e.cells[E(e,r,n)]}function N(e,r){return r%e.cellsWide}function v(e,r){return Math.floor(r/e.cellsWide)}function A(e,r,n){return r>=0&&r<e.width&&n>=0&&n<e.height}function X(e,r,n,t){let o=c(e,r),i=c(e,n),a=E(e,o,i);if(!e.cells[a])throw new Error(`Cell index ${a} out of bounds of grid`);return Y(e.cells[a],t),a}function H(e,r,n){e.cells[r]&&$(e.cells[r],n)}function Q(e,r,n,t,o){return H(e,t,o),X(e,r,n,o)}function W(e,r,n=3){let t=N(e,r),o=v(e,r),i=Math.ceil(t-n/2),a=Math.ceil(o-n/2),p=Math.floor(t+n/2),y=Math.floor(o+n/2),h=[];for(let b=i;b<=p;b++)for(let s=a;s<=y;s++)A(e,b,s)&&w(e,b,s).dense.forEach(l=>h.push(l));return h}function Z(e,r,n,t){let o=c(e,r),i=c(e,n),a=E(e,o,i);return W(e,a,t)}function ee(e,r,n,t,o){let i=c(e,r),a=c(e,n),p=Math.ceil(i-t/2),y=Math.ceil(a-o/2),h=Math.floor(i+t/2),b=Math.floor(a+o/2),s=[];for(let l=p;l<=h;l++)for(let m=y;m<=b;m++)A(e,l,m)&&w(e,l,m).dense.forEach(x=>s.push(x));return s}function re(e,r,n,t,o){let i=c(e,r),a=c(e,n),p=Math.ceil(i-t/2),y=Math.ceil(a-o/2),h=Math.floor(i+t/2),b=Math.floor(a+o/2),s=[];for(let l=p;l<=h;l++)for(let m=y;m<=b;m++){if(!A(e,l,m))continue;let x=w(e,l,m);x.dense.length&&s.push(x)}return s}var ne={...T};0&&(module.exports={SYMBOLS,createSpatialGrid,createUint32SparseSet,isSabSupported,sparseSetAdd,sparseSetGetDense,sparseSetGetLength,sparseSetGrow,sparseSetHas,sparseSetOnGrow,sparseSetRemove,spatialGridAdd,spatialGridBroadphaseCell,spatialGridBroadphasePosition,spatialGridBroadphaseRadius,spatialGridBroadphaseView,spatialGridGetCell,spatialGridGetCellX,spatialGridGetCellY,spatialGridInBounds,spatialGridIndexOf,spatialGridRefresh,spatialGridRemove,spatialGridToCell});
